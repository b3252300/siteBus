import{j as J,k as c,o as k,n as P,s as j,c as D,e as s,w as t,a as o,F as x,f as N,v as y,d as i,B,t as _,h as p,m as C,g as q,y as T,x as G,b as f,C as A,_ as K}from"./index-DcN3C2cl.js";import{u as Q,M as W,L as X,B as Z}from"./BusSidebar-D4AV_DRg.js";import{u as ee}from"./date-TIK336lM.js";import{t as M}from"./tdxApi-B5FbKraf.js";import{f as te}from"./bus-BvN3M9B5.js";import"./MapLayout.vue_vue_type_style_index_0_scoped_3b769f6d_lang-BhciEHik.js";const se={class:"news-container"},ae={class:"page-title"},ne=["innerHTML"],le={class:"page-title"},oe=["innerHTML"],ie=J({__name:"ExplainView",setup(re){const{newslist:S}=te(),r=Q(),m=c(!1),{GetDateYYYYMMDD:V}=ee(),v=c([]),n=c(null);k(()=>{R()});async function R(){try{r.openLoading();const e=[H()];await Promise.allSettled(e)}catch(e){console.error(e)}finally{r.closeLoading()}}const u=c([]),z=(e,a)=>{console.log(e.NewsID),m.value=!0,u.value=[],e&&(u.value[a]=!0,I(e.NewsID))};function H(){M.get("/Bus/News/City/Tainan?%24top=30&%24format=JSON").then(e=>{console.log(e),v.value=e.data.Newses,console.log(S,"newslist")}).catch(e=>{console.log(e)})}function I(e){console.log(e,"NewsID"),e&&(r.openLoading(),M.get(`/Bus/News/City/Tainan?$filter=contains(NewsID, '${e}')&$format=JSON`).then(a=>{n.value=a.data||null}).finally(()=>{r.closeLoading()}))}const U=()=>{r.closeLoading()},d=c(null),w=c("100vh"),L=()=>{if(d.value){const e=d.value.getBoundingClientRect().height;w.value=`calc(95vh - ${e}px - 20px)`}};return k(async()=>{await P(),L();const e=new ResizeObserver(()=>{L()});d.value&&e.observe(d.value),j(()=>{e.disconnect()})}),(e,a)=>{const $=o("el-empty"),h=o("el-link"),Y=o("el-tag"),E=o("el-descriptions-item"),O=o("el-descriptions"),g=o("el-scrollbar"),F=o("el-drawer");return f(),D(x,null,[s(W,{width:"500px"},{sidebar:t(()=>[s(Z,null,{top:t(()=>[i("div",{ref_key:"titleRef",ref:d,class:"title-container__label",style:{padding:"10px 10px 0"}},"公車最新消息",512)]),default:t(()=>[s(g,{style:B({height:w.value})},{default:t(()=>[!T(r).loading&&v.value.length===0?(f(),C($,{key:0,description:"無資料"})):q("",!0),s(O,{column:"1",border:""},{default:t(()=>[(f(!0),D(x,null,G(v.value,(l,b)=>(f(),C(E,{label:T(V)(l.SrcUpdateTime),key:l.NewsID},{default:t(()=>[i("div",{class:A(["descriptions__item",{descriptions__active:u.value[b]}])},[s(h,{onClick:ce=>z(l,b)},{default:t(()=>[p(_(l.Title),1)]),_:2},1032,["onClick"]),s(Y,{size:"small",type:"success"},{default:t(()=>[p(_(l.Department),1)]),_:2},1024)],2)]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["style"])]),_:1})]),map:t(()=>[s(X,{ref:"mapRef"},null,512)]),default:t(()=>[N(i("div",se,[s(g,{style:B({height:w.value})},{default:t(()=>[i("h2",ae,_(n.value?.Newses[0]?.Title),1),N(i("div",{innerHTML:n.value?.Newses[0]?.Description},null,8,ne),[[y,u.value.length>0]]),s(h,{href:n.value?.Newses[0]?.NewsURL,target:"_blank"},{default:t(()=>[...a[1]||(a[1]=[p("相關連結",-1)])]),_:1},8,["href"])]),_:1},8,["style"])],512),[[y,n.value]])]),_:1}),s(F,{class:"newsDrawer-container","modal-class":"newsDrawer-container",modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=l=>m.value=l),direction:"btt",size:"100%",resizable:"",onClose:U},{default:t(()=>[s(g,{style:{height:"100%"}},{default:t(()=>[i("h2",le,_(n.value?.Newses[0]?.Title),1),N(i("div",{innerHTML:n.value?.Newses[0]?.Description},null,8,oe),[[y,u.value.length>0]]),s(h,{href:n.value?.Newses[0]?.NewsURL,target:"_blank"},{default:t(()=>[...a[2]||(a[2]=[p("相關連結",-1)])]),_:1},8,["href"])]),_:1})]),_:1},8,["modelValue"])],64)}}}),ve=K(ie,[["__scopeId","data-v-017e4ad9"]]);export{ve as default};
